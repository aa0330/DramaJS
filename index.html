<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="视频播放器进度条组件" />
    <title>视频播放器进度条</title>
    <style>
      :root {
        --primary-color: #ff416c;
        --secondary-color: #ff4b2b;
        --bg-color: #bfbfbf;
        --hover-bg-color: #e6e6e6;
        --text-color: #ccc;
        --handle-size: 24px;
        --progress-height: 6px;
        --progress-hover-height: 8px;
        --border-radius: 3px;
        --transition-duration: 0.1s;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .video-player {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .progress-wrapper {
        width: 100%;
        height: 12px;
        padding: 4px 3px;
        position: relative;
        display: flex;
        align-items: center;
        transition: height var(--transition-duration) ease;
        border-radius: var(--border-radius);
        margin-bottom: 15px;
      }

      .progress-wrapper:hover {
        background-color: var(--hover-bg-color);
      }

      .progress-container {
        position: relative;
        display: flex;
        width: 100%;
        height: var(--progress-height);
        background: var(--bg-color);
        border-radius: var(--border-radius);
        transition: height var(--transition-duration) ease;
        cursor: pointer;
        outline: none;
      }

      .progress-container:hover {
        height: var(--progress-hover-height);
      }

      .progress-container:focus {
        box-shadow: 0 0 0 2px rgba(255, 65, 108, 0.3);
      }

      .progress-bar {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: var(--border-radius);
        transition: width var(--transition-duration) ease;
        opacity: 1;
      }

      .progress-handle {
        position: absolute;
        left: -6px;
        width: var(--handle-size);
        height: var(--handle-size);
        transform: translateY(-40%);
        cursor: grab;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.2s ease, transform 0.2s ease;
        outline: none;
      }

      .progress-handle:active {
        cursor: grabbing;
      }

      .progress-handle svg {
        width: 100%;
        height: 100%;
        opacity: 1;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      }

      .progress-wrapper:hover .progress-handle {
        opacity: 1;
        transform: translateY(-50%);
      }

      .progress-container.dragging .progress-handle {
        opacity: 1;
      }

      .controls {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-top: 10px;
      }

      .time-display {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: var(--text-color);
        font-weight: 500;
        user-select: none;
      }

      .time-current,
      .time-total {
        font-variant-numeric: tabular-nums;
        color: #333;
      }

      .play-button {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        outline: none;
      }

      .play-button:hover {
        background: var(--secondary-color);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(255, 65, 108, 0.3);
      }

      .play-button:focus {
        box-shadow: 0 0 0 3px rgba(255, 65, 108, 0.3);
      }

      .play-button:active {
        transform: translateY(0);
      }

      @media (max-width: 768px) {
        .video-player {
          margin: 10px;
          padding: 15px;
        }

        .controls {
          flex-wrap: wrap;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <main class="video-player">
      <h1>视频播放器进度条</h1>

      <div class="progress-wrapper" role="group" aria-label="视频进度控制">
        <div
          id="progressContainer"
          class="progress-container"
          role="slider"
          aria-label="视频进度"
          aria-valuemin="0"
          aria-valuemax="100"
          aria-valuenow="0"
          aria-valuetext="00:00 / 90:10:30"
          tabindex="0"
        >
          <div id="progressBar" class="progress-bar" aria-hidden="true"></div>
          <button
            id="progressHandle"
            class="progress-handle"
            aria-label="拖拽调整进度"
            tabindex="-1"
          >
            <svg
              t="1761025237922"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="1767"
              width="200"
              height="200"
            >
              <path
                d="M249.621943 950.506057s156.768549-7.835063 260.953234-8.788846c115.758811-1.059109 300.163657 8.788846 300.163657 8.788846l191.318309 21.632732s-298.896823 17.712274-491.481966 17.577691C321.682286 989.584823 46.811429 972.138789 46.811429 972.138789l202.810514-21.632732z"
                fill="#000000"
                opacity=".5"
                p-id="1768"
              ></path>
              <path
                d="M176.41472 185.472731c-27.112594 85.425006-38.955886 192.137509-41.972297 267.337143l-0.175543 4.28032-2.451749 3.513783c-55.840183 79.904183-64.289646 148.427337-55.863588 214.858606 7.715109 60.810971 43.394194 107.280091 86.460708 142.347703 43.116251 35.108571 92.52864 57.847223 125.179612 71.150445 52.908617 21.553737 144.661943 43.06944 246.310034 41.937189 101.586651-1.129326 211.657874-24.848091 302.606629-92.20096 118.037943-87.411566 133.029303-272.2816 44.652251-377.039726l-3.039817-3.607405-0.362789-4.701623c-13.794743-178.711406-52.077714-279.800686-91.431497-334.660755-39.315749-54.80448-78.58176-62.452297-96.744594-59.061394-4.850834 0.906971-12.770743 5.977234-23.127771 18.2272-9.839177 11.63264-20.014811 27.481234-29.862766 45.392457-19.654949 35.746377-36.931291 77.706971-46.782172 105.381303l-4.62848 12.998949-13.247634-3.861943c-22.586514-6.582857-51.726629-9.836251-79.81056-10.558903-28.086857-0.719726-53.8624 1.117623-69.500343 4.122331l-12.086125 2.320092-4.356389-11.50976c-26.995566-71.366949-52.118674-115.17952-72.025234-140.873143-9.956206-12.849737-18.382263-20.877897-24.812983-25.570743-6.427794-4.692846-9.716297-5.237029-9.988389-5.280914l-0.014628-0.002926-0.801646-0.011703-0.795794-0.096548c-26.764434-3.291429-49.614263 8.00768-69.983086 31.872731-20.714057 24.271726-37.753417 60.47744-51.34336 103.298194zM300.637623 21.182171c-38.903223-4.534857-70.524343 13.165714-95.132526 42.001555-24.400457 28.593006-42.896823 69.076114-56.97536 113.435794-27.706514 87.300389-39.807269 194.530743-43.142583 270.760229-58.253897 85.024183-67.572297 159.922469-58.458697 231.763382 8.987794 70.843246 50.497829 123.482697 97.010834 161.356069 46.460343 37.829486 99.014949 61.867154 132.613852 75.556571 56.600869 23.06048 152.224914 45.269577 257.673508 44.096366 105.515886-1.173211 222.260663-25.790171 319.695726-97.944137 130.726766-96.80896 148.117211-297.992777 52.642377-415.741074-14.303817-178.547566-53.095863-284.373577-96.466651-344.830537-43.783314-61.036251-93.341989-76.843886-125.884709-70.773029-15.427291 2.881829-28.99968 14.97088-40.09984 28.095634-11.618011 13.736229-22.867383 31.468983-33.15712 50.190629-17.805897 32.37888-33.560869 69.213623-44.102217 97.122011-23.139474-5.207771-49.456274-7.682926-73.979611-8.311954-23.461303-0.602697-46.077074 0.462263-63.599177 2.717989-26.07104-66.700434-50.878171-110.08-71.993052-137.333029-11.132343-14.365257-21.460114-24.546743-30.687817-31.278811-8.537234-6.234697-17.466514-10.491611-25.956937-10.883658z"
                fill="#835104"
                p-id="1769"
              ></path>
              <path
                d="M301.348571 49.737143c-128.702171-15.798857-162.295223 255.540663-168.228571 403.207314-56.703269 81.004251-68.684069 151.355977-60.064914 219.153554 16.287451 128.190171 150.563109 192.997669 215.180434 219.276435 106.800274 43.441006 365.500709 85.149989 549.229714-50.682149 121.97888-90.179291 133.020526-279.692434 41.711909-387.74784C852.0704 102.361966 735.530423 49.298286 686.08 58.514286c-39.561509 7.3728-82.838674 126.540069-102.4 181.394285-47.352686-13.780114-137.967909-15.813486-171.154286-9.450057-53.274331-140.601051-101.920183-179.586194-111.177143-180.721371z"
                fill="#FFF2DF"
                p-id="1770"
              ></path>
              <path
                d="M573.448777 592.205531c0 21.656137-27.241326 52.730149-60.84608 52.730149-33.601829 0-60.843154-31.074011-60.843154-52.730149 0-21.656137 27.241326-39.210423 60.843154-39.210422 33.604754 0 60.84608 17.554286 60.84608 39.210422z"
                fill="#5A3703"
                p-id="1771"
              ></path>
              <path
                d="M363.303497 640.947931a11.702857 11.702857 0 0 1 15.377554 6.120595c2.685806 6.243474 10.07616 17.188571 21.87264 24.508708 11.252297 6.98368 26.942903 10.988983 47.987566 3.56352 48.917943-17.267566 88.148846-13.101349 127.253943-0.067291 13.59872 4.531931 31.442651 4.347611 46.767543-0.760686 15.444846-5.149257 25.810651-14.31552 28.809508-25.617554a11.702857 11.702857 0 0 1 22.624549 6.003566c-5.789989 21.822903-24.49408 35.304594-44.032 41.817234-19.6608 6.5536-42.718354 7.04512-61.571657 0.760686-35.257783-11.752594-69.03808-15.251749-112.063634-0.064366-28.075154 9.906469-51.144411 4.786469-68.119406-5.746103-16.427886-10.196114-26.729326-25.158217-31.0272-35.140754a11.702857 11.702857 0 0 1 6.120594-15.377555z"
                fill="#835104"
                p-id="1772"
              ></path>
              <path
                d="M515.987749 662.533851c-28.806583 0-48.970606 5.787063-64.520778 10.251703l-3.145142 0.898195c-15.693531 4.46464-24.622811 6.243474-36.518766 2.504411l-19.277532-6.06208-3.306057 19.935817c-4.286171 25.84576-2.720914 65.673509 13.882515 100.179383 17.232457 35.810743 50.679223 65.442377 107.008 66.943269 33.777371 0.898194 60.214126-7.70048 80.237714-22.665509 19.839269-14.82752 32.001463-34.859886 39.268937-54.626011 7.246994-19.713463 9.877211-39.807269 10.30144-55.995246 0.210651-8.133486-0.128731-15.497509-0.792869-21.582994-0.6144-5.61152-1.641326-11.492206-3.405531-15.901258l-5.558857-13.900068-14.605166 3.29728c-16.922331 3.820983-32.800183 1.39264-49.093486-2.761874-4.081371-1.038629-8.083749-2.159177-12.1856-3.306058l-0.198948-0.055588a493.216914 493.216914 0 0 0-12.112457-3.279726c-8.080823-2.042149-16.9984-3.873646-25.977417-3.873646z"
                fill="#835104"
                p-id="1773"
              ></path>
              <path
                d="M515.984823 718.166309c-53.642971 0-91.267657 30.646857-103.435703 47.999268 4.05504 20.956891 27.89376 68.68992 92.616411 73.0112 67.60448 4.517303 96.674377-32.6656 109.521189-68.496823-10.140526-15.547246-42.592549-52.513646-98.701897-52.513645z"
                fill="#FCB0A2"
                p-id="1774"
              ></path>
              <path
                d="M297.624137 605.725257c32.855771 0 59.491474-13.013577 59.491474-29.069897 0-16.053394-26.635703-29.069897-59.491474-29.069897s-59.491474 13.016503-59.491474 29.069897c0 16.05632 26.632777 29.069897 59.491474 29.069897z m429.960046 0c-32.855771 0-59.491474-13.013577-59.491474-29.069897 0-16.053394 26.635703-29.069897 59.491474-29.069897s59.491474 13.016503 59.491474 29.069897c0 16.05632-26.635703 29.069897-59.491474 29.069897z"
                fill="#F79A99"
                opacity=".5"
                p-id="1775"
              ></path>
              <path
                d="M355.57376 562.480274c24.891977-4.406126 42.765166-21.018331 39.918446-37.106834-2.84672-16.085577-25.336686-25.553189-50.231589-21.147063-24.891977 4.406126-42.765166 21.018331-39.91552 37.106834 2.84672 16.085577 25.33376 25.553189 50.228663 21.147063z m309.08416-0.087771c-23.49056-4.160366-40.357303-19.836343-37.668571-35.017874 2.685806-15.178606 23.908937-24.113737 47.399497-19.956298 23.493486 4.15744 40.360229 19.836343 37.671497 35.014949-2.685806 15.181531-23.908937 24.116663-47.402423 19.959223z"
                fill="#5A3703"
                p-id="1776"
              ></path>
              <path
                d="M492.649326 573.715017c0.816274 2.483931-3.408457 6.105966-9.435429 8.0896-6.029897 1.983634-11.579977 1.579886-12.396251-0.90112-0.8192-2.483931 3.405531-6.105966 9.435428-8.0896 6.029897-1.983634 11.579977-1.579886 12.396252 0.90112z"
                fill="#FFFFFF"
                opacity=".6"
                p-id="1777"
              ></path>
              <path
                d="M515.311909 537.465417c-36.942994-0.482743-73.549531 4.596297-96.627566 14.39744a8.777143 8.777143 0 0 1-6.8608-16.15872c26.272914-11.158674 65.653029-16.287451 103.716571-15.79008 37.966994 0.494446 76.639086 6.61504 101.188755 19.473554a8.777143 8.777143 0 1 1-8.145189 15.550172c-20.877897-10.93632-56.232229-16.986697-93.271771-17.472366z"
                fill="#480D21"
                opacity=".2"
                p-id="1778"
              ></path>
              <path
                d="M367.256137 538.123703a8.78592 8.78592 0 1 0 0-17.57184 8.78592 8.78592 0 0 0 0 17.57184z m286.63808 0a8.78592 8.78592 0 1 0 0.002926-17.574766 8.78592 8.78592 0 0 0-0.002926 17.574766z"
                fill="#FFFFFF"
                p-id="1779"
              ></path>
              <path
                d="M150.934674 955.04384c-22.533851 10.591086-67.739063 20.146469-68.28032-26.366537-0.67584-58.139794 27.042377-168.333897 145.349486-137.91232 118.307109 30.421577 131.150994 121.010469 125.741349 137.91232-5.40672 16.901851-16.898926 40.562103-54.757669 26.366537-9.239406 22.533851-37.589577 57.05728-77.069166 14.871406-15.096686 13.297371-50.433463 28.935314-70.98368-14.871406z m725.035886 0c22.533851 10.591086 67.739063 20.146469 68.28032-26.366537 0.67584-58.139794-27.042377-168.333897-145.349486-137.91232-118.307109 30.421577-131.150994 121.010469-125.744274 137.91232 5.409646 16.901851 16.901851 40.562103 54.760594 26.366537 9.239406 22.533851 37.586651 57.05728 77.069166 14.871406 15.096686 13.297371 50.433463 28.935314 70.98368-14.871406z"
                fill="#FFF2DF"
                p-id="1780"
              ></path>
              <path
                d="M97.28 928.507611c-0.315977-27.408091 6.193737-66.053851 25.427383-93.625782 9.4208-13.502171 21.66784-24.069851 37.56032-29.821806 15.907109-5.760731 36.744046-7.159223 64.090697-0.125806 55.565166 14.286263 85.117806 42.244389 100.401737 67.443566 7.738514 12.75904 11.942766 25.017783 13.917623 34.79552 0.988891 4.89472 1.395566 9.043383 1.445303 12.203154 0.046811 3.177326-0.272091 4.66944-0.3072 4.830354l-0.002926 0.014629c-2.583406 8.077897-5.699291 14.309669-10.093714 17.627429-3.130514 2.363977-9.824549 5.412571-25.597074-0.503223l-13.285669-4.982492-5.383314 13.130606c-4.011154 9.783589-11.498057 20.087954-19.8656 24.011337-3.66592 1.714469-7.601006 2.29376-12.317257 0.968412-5.020526-1.407269-12.00128-5.286766-20.670172-14.552503l-9.698743-10.36288-10.6496 9.37984c-6.047451 5.3248-15.389257 10.266331-23.885531 10.327771a19.090286 19.090286 0 0 1-11.430766-3.548891c-3.856091-2.688731-8.434834-7.671223-12.756114-16.887223l-6.220069-13.25056-13.247634 6.22592c-10.187337 4.789394-23.990857 8.484571-34.023131 6.998308-4.578743-0.678766-7.3728-2.270354-9.169189-4.376868-1.831497-2.153326-4.128183-6.61504-4.236434-15.918812z m134.366354-151.908937c-31.802514-8.180297-58.801006-7.211886-81.340708 0.950857-22.557257 8.168594-39.380114 23.08096-51.594972 40.59136-24.031817 34.456137-31.041829 79.9744-30.684891 110.706103 0.16384 13.952731 3.718583 25.740434 11.217188 34.546835 7.539566 8.850286 17.554286 12.928731 27.159406 14.350628 12.931657 1.916343 26.723474-0.687543 38.063543-4.426606 4.593371 6.831543 9.856731 12.299703 15.743269 16.401555a48.347429 48.347429 0 0 0 28.367725 8.803474c12.141714-0.087771 23.288686-4.411977 32.042423-9.657783 8.086674 6.808137 16.334263 11.419063 24.745692 13.777189 11.989577 3.364571 23.12192 1.811017 32.636342-2.644846 12.843886-6.018194 22.28224-17.036434 28.534492-27.487086 16.372297 3.507931 30.055863 0.810423 40.813714-7.314285 12.170971-9.189669 17.507474-23.238949 20.330789-32.059978 2.486857-7.773623 2.141623-19.549623-0.324755-31.755702-2.606811-12.911177-7.993051-28.370651-17.580617-44.17536-19.362377-31.925394-55.386697-64.473966-118.12864-80.606355z m697.975955 151.908937c0.318903-27.408091-6.190811-66.053851-25.424458-93.625782-9.417874-13.502171-21.670766-24.069851-37.56032-29.821806-15.907109-5.760731-36.744046-7.159223-64.093622-0.125806-55.56224 14.286263-85.11488 42.244389-100.398812 67.443566-7.738514 12.75904-11.942766 25.017783-13.917623 34.79552-0.988891 4.89472-1.395566 9.043383-1.445303 12.203154-0.049737 3.177326 0.272091 4.66944 0.3072 4.830354a0.08192 0.08192 0 0 1 0.002926 0.014629c2.583406 8.077897 5.699291 14.309669 10.093714 17.627429 3.130514 2.363977 9.824549 5.412571 25.594149-0.503223l13.288594-4.982492 5.383315 13.130606c4.011154 9.783589 11.498057 20.087954 19.8656 24.011337 3.66592 1.714469 7.601006 2.29376 12.320182 0.968412 5.0176-1.407269 11.998354-5.286766 20.667246-14.552503l9.698743-10.36288 10.6496 9.37984c6.044526 5.3248 15.386331 10.266331 23.885531 10.327771a19.090286 19.090286 0 0 0 11.430766-3.548891c3.856091-2.688731 8.434834-7.671223 12.756114-16.887223l6.220069-13.25056 13.247634 6.22592c10.187337 4.789394 23.990857 8.484571 34.020206 6.998308 4.581669-0.678766 7.375726-2.270354 9.172114-4.376868 1.831497-2.153326 4.128183-6.61504 4.236435-15.918812z m-134.363429-151.908937c31.80544-8.180297 58.79808-7.211886 81.340709 0.950857 22.560183 8.168594 39.377189 23.08096 51.594971 40.59136 24.031817 34.456137 31.041829 79.9744 30.684891 110.706103-0.16384 13.952731-3.718583 25.740434-11.220114 34.546835-7.53664 8.850286-17.55136 12.928731-27.15648 14.350628-12.931657 1.916343-26.723474-0.687543-38.060617-4.426606-4.599223 6.831543-9.859657 12.299703-15.746194 16.401555a48.344503 48.344503 0 0 1-28.367726 8.803474c-12.141714-0.087771-23.288686-4.411977-32.042423-9.657783-8.086674 6.808137-16.334263 11.419063-24.745691 13.777189-11.989577 3.364571-23.12192 1.811017-32.636343-2.644846-12.843886-6.018194-22.28224-17.036434-28.534492-27.487086-16.372297 3.507931-30.055863 0.810423-40.813714-7.314285-12.170971-9.189669-17.507474-23.238949-20.330788-32.059978-2.486857-7.773623-2.141623-19.549623 0.324754-31.755702 2.606811-12.911177 7.993051-28.370651 17.580617-44.17536 19.362377-31.925394 55.383771-64.473966 118.12864-80.606355z"
                fill="#835104"
                p-id="1781"
              ></path>
              <path
                d="M200.013531 377.973029c-21.916526 1.123474 18.080914-238.445714 89.632183-239.0016 11.776 0.69632 74.143451 78.327223 71.68 100.937142-1.378011 12.639086-37.727086 39.85408-77.29152 69.471086-31.202743 23.358903-64.400823 48.20992-84.020663 68.593372z m608.838218 7.832137c21.9136 1.123474-21.966263-240.426423-93.514606-240.982309-11.776 0.693394-70.261029 80.307931-67.800503 102.917852 1.378011 12.639086 37.730011 39.85408 77.294446 69.471085 31.199817 23.355977 64.400823 48.20992 84.020663 68.593372z"
                fill="#ECC48B"
                p-id="1782"
              ></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="controls">
        <button
          type="button"
          class="play-button"
          id="playButton"
          aria-label="播放/暂停视频"
        >
          播放
        </button>
        <div class="time-display" aria-live="polite">
          <span class="time-current" id="currentTime" aria-label="当前时间"
            >00:00</span
          >
          <span aria-hidden="true">/</span>
          <span class="time-total" id="totalTime" aria-label="总时长"
            >90:10:30</span
          >
        </div>
      </div>
    </main>
    <script>
      /**
       * 视频播放器进度条控制器
       * 提供播放控制、进度拖拽、时间显示等功能
       */
      class VideoProgressController {
        constructor() {
          this.initElements();
          this.initState();
          this.bindEvents();
          this.updateAccessibility();
        }

        /**
         * 初始化DOM元素
         */
        initElements() {
          this.elements = {
            progressBar: document.getElementById("progressBar"),
            progressContainer: document.getElementById("progressContainer"),
            progressHandle: document.getElementById("progressHandle"),
            currentTimeDisplay: document.getElementById("currentTime"),
            totalTimeDisplay: document.getElementById("totalTime"),
            playButton: document.getElementById("playButton"),
          };

          // 验证必要元素是否存在
          Object.entries(this.elements).forEach(([key, element]) => {
            if (!element) {
              throw new Error(`找不到必要的DOM元素: ${key}`);
            }
          });
        }

        /**
         * 初始化状态
         */
        initState() {
          this.state = {
            playTimer: null,
            currentSecond: 0,
            totalSecond: this.timeToSeconds(
              this.elements.totalTimeDisplay.textContent
            ),
            isDragging: false,
            isPlaying: false,
          };

          // 性能优化：缓存DOM计算结果
          this.cache = {
            containerRect: null,
            containerWidth: 0,
            lastUpdateTime: 0,
          };

          // 防抖和节流函数
          this.throttledUpdateProgress = this.throttle(
            this.updateProgressFromPosition.bind(this),
            16
          ); // 60fps
          this.debouncedResize = this.debounce(
            this.handleResize.bind(this),
            150
          );
        }

        /**
         * 防抖函数
         * @param {Function} func - 需要防抖的函数
         * @param {number} wait - 等待时间（毫秒）
         * @returns {Function} 防抖后的函数
         */
        debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func.apply(this, args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        }

        /**
         * 节流函数
         * @param {Function} func - 需要节流的函数
         * @param {number} limit - 限制时间间隔（毫秒）
         * @returns {Function} 节流后的函数
         */
        throttle(func, limit) {
          let inThrottle;
          return function executedFunction(...args) {
            if (!inThrottle) {
              func.apply(this, args);
              inThrottle = true;
              setTimeout(() => (inThrottle = false), limit);
            }
          };
        }

        /**
         * 更新容器尺寸缓存
         */
        updateContainerCache() {
          const rect = this.elements.progressContainer.getBoundingClientRect();
          this.cache.containerRect = rect;
          this.cache.containerWidth = rect.width;
        }

        /**
         * 处理窗口大小变化
         */
        handleResize() {
          this.updateContainerCache();
          // 重新计算进度条位置
          const progress = this.calculateProgress(
            this.state.currentSecond,
            this.state.totalSecond
          );
          this.updateProgressDisplay(progress, this.state.currentSecond);
        }

        /**
         * 时间格式转换工具
         * @param {number|string} time - 时间值
         * @param {string} type - 转换类型: 'toNormal' 或 'toSeconds'
         * @returns {string|number} 转换后的时间
         */
        formatTime(time, type = "toNormal") {
          if (type === "toNormal") {
            return this.secondsToTime(time);
          }
          if (type === "toSeconds") {
            return this.timeToSeconds(time);
          }
          return time;
        }

        /**
         * 秒数转换为时间字符串
         * @param {number} seconds - 秒数
         * @returns {string} 格式化的时间字符串
         */
        secondsToTime(seconds) {
          const hours = Math.floor(seconds / 3600);
          const minutes = Math.floor((seconds % 3600) / 60);
          const secs = Math.floor(seconds % 60);

          if (hours > 0) {
            return `${hours.toString().padStart(2, "0")}:${minutes
              .toString()
              .padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
          }
          return `${minutes.toString().padStart(2, "0")}:${secs
            .toString()
            .padStart(2, "0")}`;
        }

        /**
         * 时间字符串转换为秒数
         * @param {string} timeString - 时间字符串 (如: "01:30" 或 "1:30:45")
         * @returns {number} 总秒数
         */
        timeToSeconds(timeString) {
          const parts = timeString.split(":").map((part) => parseInt(part, 10));
          let seconds = 0;

          if (parts.length === 3) {
            // HH:MM:SS 格式
            seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
          } else if (parts.length === 2) {
            // MM:SS 格式
            seconds = parts[0] * 60 + parts[1];
          } else if (parts.length === 1) {
            // SS 格式
            seconds = parts[0];
          }

          return seconds || 0;
        }

        /**
         * 计算进度百分比
         * @param {number} current - 当前秒数
         * @param {number} total - 总秒数
         * @returns {number} 百分比 (0-100)
         */
        calculateProgress(current, total) {
          if (total === 0) return 0;
          return Math.max(0, Math.min(100, (current / total) * 100));
        }

        /**
         * 更新进度条显示
         * @param {number} progressPercent - 进度百分比
         * @param {number} currentSeconds - 当前秒数
         */
        updateProgressDisplay(progressPercent, currentSeconds) {
          // 使用requestAnimationFrame优化DOM更新
          requestAnimationFrame(() => {
            this.elements.progressBar.style.width = `${progressPercent}%`;
            this.elements.currentTimeDisplay.textContent =
              this.secondsToTime(currentSeconds);

            // 使用缓存的容器宽度减少DOM查询
            if (!this.cache.containerWidth) {
              this.updateContainerCache();
            }
            const handlePosition =
              (progressPercent / 100) * this.cache.containerWidth - 12;
            this.elements.progressHandle.style.left = `${Math.max(
              -6,
              Math.min(this.cache.containerWidth - 18, handlePosition)
            )}px`;

            this.updateAccessibility();
          });
        }

        /**
         * 更新无障碍访问属性
         */
        updateAccessibility() {
          const progress = this.calculateProgress(
            this.state.currentSecond,
            this.state.totalSecond
          );
          const currentTime = this.secondsToTime(this.state.currentSecond);
          const totalTime = this.secondsToTime(this.state.totalSecond);

          this.elements.progressContainer.setAttribute(
            "aria-valuenow",
            Math.round(progress)
          );
          this.elements.progressContainer.setAttribute(
            "aria-valuetext",
            `${currentTime} / ${totalTime}`
          );
        }

        /**
         * 处理拖拽开始
         * @param {Event} event - 鼠标事件
         */
        handleDragStart(event) {
          event.preventDefault();
          this.state.isDragging = true;
          this.elements.progressContainer.classList.add("dragging");

          // 添加全局事件监听器
          document.addEventListener(
            "mousemove",
            this.handleDragMove.bind(this)
          );
          document.addEventListener("mouseup", this.handleDragEnd.bind(this));

          // 阻止文本选择
          document.body.style.userSelect = "none";
        }

        /**
         * 处理拖拽移动
         * @param {Event} event - 鼠标事件
         */
        handleDragMove(event) {
          if (!this.state.isDragging) return;

          event.preventDefault();
          // 使用节流优化拖拽性能
          this.throttledUpdateProgress(event.clientX);
        }

        /**
         * 处理拖拽结束
         * @param {Event} event - 鼠标事件
         */
        handleDragEnd(event) {
          if (!this.state.isDragging) return;

          event.preventDefault();
          this.state.isDragging = false;
          this.elements.progressContainer.classList.remove("dragging");

          // 移除全局事件监听器
          document.removeEventListener(
            "mousemove",
            this.handleDragMove.bind(this)
          );
          document.removeEventListener(
            "mouseup",
            this.handleDragEnd.bind(this)
          );

          // 恢复文本选择
          document.body.style.userSelect = "";
        }

        /**
         * 根据鼠标位置更新进度
         * @param {number} clientX - 鼠标X坐标
         */
        updateProgressFromPosition(clientX) {
          // 使用缓存的矩形信息减少DOM查询
          if (!this.cache.containerRect) {
            this.updateContainerCache();
          }

          const rect = this.cache.containerRect;
          const relativeX = clientX - rect.left;
          const progress = Math.max(0, Math.min(1, relativeX / rect.width));

          const newCurrentSecond = Math.floor(
            progress * this.state.totalSecond
          );

          // 避免不必要的更新
          if (newCurrentSecond === this.state.currentSecond) {
            return;
          }

          this.state.currentSecond = newCurrentSecond;
          const progressPercent = this.calculateProgress(
            newCurrentSecond,
            this.state.totalSecond
          );
          this.updateProgressDisplay(progressPercent, newCurrentSecond);
        }

        /**
         * 处理进度条点击跳转
         * @param {Event} event - 鼠标事件
         */
        handleProgressClick(event) {
          if (this.state.isDragging) return;

          event.preventDefault();
          this.updateProgressFromPosition(event.clientX);
        }

        /**
         * 切换播放/暂停状态
         */
        togglePlayPause() {
          if (this.state.isDragging) return;

          if (this.state.isPlaying) {
            this.pause();
          } else {
            this.play();
          }
        }

        /**
         * 开始播放
         */
        play() {
          this.state.isPlaying = true;
          this.elements.playButton.textContent = "暂停";
          this.elements.playButton.setAttribute("aria-label", "暂停视频");

          this.state.playTimer = setInterval(() => {
            if (this.state.currentSecond >= this.state.totalSecond) {
              this.pause();
              return;
            }

            this.state.currentSecond++;
            const progress = this.calculateProgress(
              this.state.currentSecond,
              this.state.totalSecond
            );
            this.updateProgressDisplay(progress, this.state.currentSecond);
          }, 1000);
        }

        /**
         * 暂停播放
         */
        pause() {
          this.state.isPlaying = false;
          this.elements.playButton.textContent = "播放";
          this.elements.playButton.setAttribute("aria-label", "播放视频");

          if (this.state.playTimer) {
            clearInterval(this.state.playTimer);
            this.state.playTimer = null;
          }
        }

        /**
         * 处理键盘事件
         * @param {KeyboardEvent} event - 键盘事件
         */
        handleKeyboard(event) {
          const { key } = event;

          switch (key) {
            case " ":
              event.preventDefault();
              this.togglePlayPause();
              break;
            case "ArrowLeft":
              event.preventDefault();
              this.seek(-5); // 后退5秒
              break;
            case "ArrowRight":
              event.preventDefault();
              this.seek(5); // 前进5秒
              break;
            case "Home":
              event.preventDefault();
              this.seekTo(0);
              break;
            case "End":
              event.preventDefault();
              this.seekTo(this.state.totalSecond);
              break;
          }
        }

        /**
         * 跳转到指定时间
         * @param {number} seconds - 目标秒数
         */
        seekTo(seconds) {
          this.state.currentSecond = Math.max(
            0,
            Math.min(this.state.totalSecond, seconds)
          );
          const progress = this.calculateProgress(
            this.state.currentSecond,
            this.state.totalSecond
          );
          this.updateProgressDisplay(progress, this.state.currentSecond);
        }

        /**
         * 相对跳转
         * @param {number} deltaSeconds - 跳转的秒数（可为负数）
         */
        seek(deltaSeconds) {
          this.seekTo(this.state.currentSecond + deltaSeconds);
        }

        /**
         * 绑定事件监听器
         */
        bindEvents() {
          // 初始化容器缓存
          this.updateContainerCache();

          // 拖拽事件
          this.elements.progressHandle.addEventListener(
            "mousedown",
            this.handleDragStart.bind(this)
          );

          // 点击跳转事件
          this.elements.progressContainer.addEventListener(
            "click",
            this.handleProgressClick.bind(this)
          );

          // 播放控制事件
          this.elements.playButton.addEventListener(
            "click",
            this.togglePlayPause.bind(this)
          );

          // 键盘事件
          this.elements.progressContainer.addEventListener(
            "keydown",
            this.handleKeyboard.bind(this)
          );
          document.addEventListener("keydown", this.handleKeyboard.bind(this));

          // 窗口大小变化事件
          window.addEventListener("resize", this.debouncedResize);

          // 拖拽开始时更新缓存
          this.elements.progressHandle.addEventListener("mousedown", () => {
            this.updateContainerCache();
          });

          // 防止意外的事件冒泡
          this.elements.progressHandle.addEventListener("click", (e) =>
            e.stopPropagation()
          );
        }

        /**
         * 销毁控制器，清理资源
         */
        destroy() {
          // 清理定时器
          if (this.state.playTimer) {
            clearInterval(this.state.playTimer);
            this.state.playTimer = null;
          }

          // 移除所有事件监听器
          document.removeEventListener(
            "mousemove",
            this.handleDragMove.bind(this)
          );
          document.removeEventListener(
            "mouseup",
            this.handleDragEnd.bind(this)
          );
          document.removeEventListener(
            "keydown",
            this.handleKeyboard.bind(this)
          );
          window.removeEventListener("resize", this.debouncedResize);

          // 清理缓存
          this.cache = {
            containerRect: null,
            containerWidth: 0,
            lastUpdateTime: 0,
          };

          // 恢复文本选择
          document.body.style.userSelect = "";

          console.log("视频播放器进度条已销毁");
        }
      }

      // 页面加载完成后初始化控制器
      document.addEventListener("DOMContentLoaded", () => {
        try {
          window.videoController = new VideoProgressController();
          console.log("视频播放器进度条初始化成功");
        } catch (error) {
          console.error("视频播放器进度条初始化失败:", error);
        }
      });

      // 页面卸载时清理资源
      window.addEventListener("beforeunload", () => {
        if (window.videoController) {
          window.videoController.destroy();
        }
      });
    </script>
  </body>
</html>
